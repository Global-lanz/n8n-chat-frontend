<div class="settings-container">
  <div class="settings-header">
    <h1>‚öôÔ∏è Configura√ß√µes do Sistema</h1>
    <p class="subtitle">Gerencie configura√ß√µes administrativas e integra√ß√µes</p>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <p>‚è≥ Carregando configura√ß√µes...</p>
    </div>
  } @else {
    <div class="settings-grid">
      <!-- Dura√ß√£o da Licen√ßa -->
      <div class="card">
        <div class="card-header">
          <h3>‚è∞ Dura√ß√£o Padr√£o da Licen√ßa</h3>
          <p>Tempo em dias que novos usu√°rios ter√£o acesso ao sistema</p>
        </div>
        <div class="card-body">
          <div class="input-group">
            <input 
              type="number" 
              [(ngModel)]="licenseDuration" 
              [value]="licenseDuration()"
              (ngModelChange)="licenseDuration.set($event)"
              min="1"
              placeholder="365"
              class="input-field"
            >
            <span class="input-suffix">dias</span>
          </div>
          <button 
            (click)="saveLicenseDuration()" 
            class="btn-primary"
            [disabled]="saving()"
          >
            üíæ Salvar Dura√ß√£o
          </button>
        </div>
      </div>

      <!-- Nome do Bot -->
      <div class="card">
        <div class="card-header">
          <h3>ü§ñ Nome Padr√£o do Bot</h3>
          <p>Nome exibido para o assistente virtual</p>
        </div>
        <div class="card-body">
          <div class="input-group">
            <input 
              type="text" 
              [(ngModel)]="defaultBotName"
              [value]="defaultBotName()"
              (ngModelChange)="defaultBotName.set($event)"
              placeholder="Assistente Virtual"
              class="input-field full-width"
            >
          </div>
          <button 
            (click)="saveBotName()" 
            class="btn-primary"
            [disabled]="saving()"
          >
            üíæ Salvar Nome
          </button>
        </div>
      </div>

      <!-- Token de Webhook -->
      <div class="card card-highlight">
        <div class="card-header">
          <h3>üîí Token de Seguran√ßa do Webhook</h3>
          <p>Token para autenticar requisi√ß√µes ao webhook</p>
          <small class="code-hint">Header: <code>x-webhook-token</code></small>
        </div>
        <div class="card-body">
          @if (!showGeneratedToken()) {
            <div class="token-status">
              <span 
                class="badge" 
                [class.success]="webhookToken()"
                [class.warning]="!webhookToken()"
              >
                {{ webhookToken() ? '‚úì Token configurado' : '‚ö† Nenhum token configurado' }}
              </span>
            </div>
            <button 
              (click)="generateWebhookToken()" 
              class="btn-secondary"
            >
              {{ webhookToken() ? 'üîÑ Gerar Novo Token' : '‚ú® Gerar Token' }}
            </button>
          } @else {
            <div class="alert warning">
              ‚ö†Ô∏è <strong>Aten√ß√£o!</strong> Copie este token agora! Ele n√£o ser√° mostrado novamente.
            </div>
            <div class="token-display">
              <code class="token-value">{{ generatedToken() }}</code>
              <button 
                (click)="copyTokenToClipboard()" 
                class="btn-copy"
                [class.copied]="tokenCopied()"
              >
                {{ tokenCopied() ? '‚úì Copiado' : 'üìã Copiar' }}
              </button>
            </div>
            <div class="button-group">
              <button 
                (click)="saveWebhookToken()" 
                class="btn-primary"
                [disabled]="saving()"
              >
                üíæ Salvar Token
              </button>
              <button 
                (click)="cancelTokenGeneration()" 
                class="btn-cancel"
                [disabled]="saving()"
              >
                Cancelar
              </button>
            </div>
          }
        </div>
      </div>

      <!-- URL do Webhook -->
      <div class="card card-info">
        <div class="card-header">
          <h3>üîó URL do Webhook</h3>
          <p>Configure esta URL no sistema externo (Hotmart, N8N, etc)</p>
        </div>
        <div class="card-body">
          <div class="webhook-url">
            <code class="url-display">{{ getWebhookUrl() }}</code>
            <button 
              (click)="copyWebhookUrl()" 
              class="btn-copy"
            >
              üìã Copiar URL
            </button>
          </div>
        </div>
      </div>

      <!-- Instru√ß√µes de Integra√ß√£o -->
      <div class="card card-full">
        <div class="card-header">
          <h3>üìö Instru√ß√µes de Integra√ß√£o</h3>
        </div>
        <div class="card-body instructions">
          <ol>
            <li>
              <strong>1. Configure o Token:</strong>
              <ul>
                <li>Gere e salve o <strong>Token de Seguran√ßa</strong> acima</li>
                <li>Copie o token gerado (n√£o ser√° mostrado novamente)</li>
              </ul>
            </li>
            <li>
              <strong>2. Copie a URL do Webhook</strong>
            </li>
            <li>
              <strong>3. Configure no sistema externo:</strong>
              <div class="integration-section">
                <h4>üõí Hotmart:</h4>
                <ul>
                  <li>Acesse: <strong>Ferramentas ‚Üí Webhooks</strong></li>
                  <li>Clique em <strong>Adicionar Webhook</strong></li>
                  <li>Cole a URL do webhook</li>
                  <li>Adicione header customizado: <code>x-webhook-token: SEU_TOKEN</code></li>
                  <li>Selecione eventos: <code>PURCHASE_COMPLETE</code>, <code>PURCHASE_REFUNDED</code></li>
                </ul>
              </div>
              <div class="integration-section">
                <h4>üîÑ N8N:</h4>
                <ul>
                  <li>Use n√≥ <strong>HTTP Request</strong></li>
                  <li>M√©todo: <code>POST</code></li>
                  <li>URL: Cole a URL do webhook</li>
                  <li>Headers: <code>x-webhook-token: SEU_TOKEN</code></li>
                  <li>Body (JSON):</li>
                </ul>
                <pre class="code-block">{{'{'}}"email": "usuario&#64;example.com","name": "Nome do Usu√°rio","event": "PURCHASE_COMPLETE"{{'}'}}
</pre>
              </div>
            </li>
            <li>
              <strong>4. Eventos suportados:</strong>
              <ul>
                <li><code>PURCHASE_COMPLETE</code> - Cria novo usu√°rio ou renova licen√ßa</li>
                <li><code>SUBSCRIPTION_CREATED</code> - Cria novo usu√°rio ou renova licen√ßa</li>
                <li><code>PURCHASE_REFUNDED</code> - Desativa usu√°rio</li>
              </ul>
            </li>
          </ol>
        </div>
      </div>

      <!-- Vers√µes do Sistema -->
      <div class="card card-full">
        <div class="card-header">
          <h3>üì¶ Vers√µes do Sistema</h3>
          <p>Informa√ß√µes sobre as vers√µes instaladas</p>
        </div>
        <div class="card-body">
          <div class="version-grid">
            <!-- Frontend Version -->
            <div class="version-item frontend">
              <div class="version-label">
                <span class="version-icon">üé®</span>
                <span>Frontend</span>
              </div>
              <div class="version-display">
                <code class="version-code">v{{ frontendVersion() }}</code>
                <span [class]="getVersionBadgeClass(frontendVersion())">
                  {{ getVersionLabel(frontendVersion()) }}
                </span>
              </div>
            </div>

            <!-- Backend Version -->
            <div class="version-item backend">
              <div class="version-label">
                <span class="version-icon">‚öôÔ∏è</span>
                <span>Backend</span>
              </div>
              <div class="version-display">
                <code class="version-code">v{{ backendVersion() }}</code>
                @if (backendVersion() !== 'N/A' && backendVersion() !== 'Carregando...') {
                  <span [class]="getVersionBadgeClass(backendVersion())">
                    {{ getVersionLabel(backendVersion()) }}
                  </span>
                }
              </div>
            </div>

            <!-- Build Date -->
            @if (buildDate()) {
              <div class="version-item">
                <div class="version-label">
                  <span class="version-icon">üìÖ</span>
                  <span>Build</span>
                </div>
                <div class="version-value">
                  {{ buildDate() | date: 'dd/MM/yyyy HH:mm' }}
                </div>
              </div>
            }

            <!-- Environment -->
            <div class="version-item">
              <div class="version-label">
                <span class="version-icon">üåç</span>
                <span>Ambiente</span>
              </div>
              <div class="version-value">
                <span [class]="apiEnvironment() === 'production' ? 'badge warning' : 'badge'">
                  {{ apiEnvironment() === 'production' ? 'Produ√ß√£o' : 'Desenvolvimento' }}
                </span>
              </div>
            </div>
          </div>

          <!-- Alerta RC -->
          @if (hasRCVersion()) {
            <div class="alert alert-warning">
              <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Voc√™ est√° usando uma vers√£o Release Candidate (RC). 
              Esta vers√£o est√° em fase de testes finais e pode conter bugs. 
              N√£o recomendado para ambientes de produ√ß√£o cr√≠ticos.
            </div>
          }

          <!-- Alerta Est√°vel -->
          @if (allStable()) {
            <div class="alert alert-success">
              <strong>‚úÖ Sistema Est√°vel:</strong> Todas as vers√µes s√£o est√°veis e prontas para produ√ß√£o.
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
